

/* 
@title: Geometry Dash Sprig (Clean )
@author: you
*/

const player = "p"
const spike = "s"
const ground = "g"
const goal = "d"
const platform = "m"
const bg = "b"

setLegend(
  [player, bitmap`
................
................
.......22.......
......2222......
......2222......
.......22.......
......0000......
......0000......
.......00.......
.......00.......
.......00.......
................
................
................
................
................`],

  [spike, bitmap`
................
................
................
................
................
................
.......3........
......333.......
.....33333......
....3333333.....
...333333333....
..33333333333...
.3333333333333..
333333333333333.
333333333333333.
333333333333333.`],

  [ground, bitmap`
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777
7777777777777777`],

  [goal, bitmap`
................
................
.......44.......
......4DD4......
.....4DDDD4.....
.....4DDDD4.....
......4DD4......
.......44.......
................
................
................
................
................
................
................
................`],

  [platform, bitmap`
................
................
................
................
................
................
................
................
....66666666....
....66666666....
....66666666....
................
................
................
................
................`],

  [bg, bitmap`
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111
1111111111111111`],
)

setBackground(bg)

let level = 0

const levels = [
  map`
................
................
................
.........s......
................
.....s..........
................
................
p............d..
gggggggggggggggg`,

  map`
................
................
................
.......m........
.........s......
................
....s...........
................
p.............d.
gggggggggggggggg`
]

setSolids([player, ground, platform])
setMap(levels[level])


// ------------------ GAME VARIABLES ------------------
let vy = 0
const gravity = 0.15
let canJump = true

// Jump buttons
onInput("w", () => tryJump())
onInput("i", () => tryJump())
onInput("j", () => tryJump())

function tryJump() {
  if (canJump) {
    vy = -0.5
    canJump = false
  }
}

// ------------------ GAME LOOP ------------------
afterInput(() => {
  const pl = getFirst(player)

  // Gravity
  vy += gravity
  pl.y += vy

  // Auto-run to the right
  pl.x += 0.20

  let px = Math.floor(pl.x)
  let py = Math.floor(pl.y)

  // OFF-MAP â†’ reset
  if (px < 0 || px >= width()) {
    reset()
    return
  }

  // Ground/platform collision (SAFE)
  if (py + 1 < height()) {
    const below = getTile(px, py + 1)
    if (below.some(t => t.type === ground || t.type === platform)) {
      vy = 0
      canJump = true
      pl.y = py
    }
  }

  // Spike hit
  if (tilesWith(player, spike).length > 0) {
    reset()
    return
  }

  // Goal reached
  if (tilesWith(player, goal).length > 0) {
    level++
    if (levels[level]) {
      setMap(levels[level])
    } else {
      addText("YOU WIN!", { y: 8, color: color`4` })
    }
    return
  }

  // Fell off bottom
  if (pl.y > height()) reset()
})

function reset() {
  setMap(levels[level])
  vy = 0
  canJump = true
}


