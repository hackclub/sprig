const player = "p";
const block = "b";
const wall = "w";
const goal = "g";

setLegend(
  [ player, bitmap`
................
................
.......000......
.......0.0......
......0..0......
......0...0.0...
....0003.30.0...
....0.0...000...
....0.05550.....
......0...0.....
.....0....0.....
.....0...0......
......000.......
......0.0.......
.....00.00......
................` ],
  [ block, bitmap`
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444
4444444444444444` ],
  [ wall, bitmap`
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888
8888888888888888` ],
  [ goal, bitmap`
................
................
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
....22222222....
................
................
................` ]
);

setSolids([player, wall, block]);

setPushables({
  [player]: [block]
});

let level = 0;
const levels = [
  map`
p.b.
....
..g.`,
  map`
p.w.
.wb.
..g.`,
  map`
..w..
p.wg.
.ww..
..b..`
];

setMap(levels[level]);

onInput("s", () => {
  getFirst(player).y += 1;
});
onInput("w", () => {
  getFirst(player).y -= 1;
});
onInput("a", () => {
  getFirst(player).x -= 1;
});
onInput("d", () => {
  getFirst(player).x += 1;
});

onInput("j", () => {
  setMap(levels[level]);
});

afterInput(() => {
  const targetBlock = getFirst(block);
  const targetGoal = getFirst(goal);

  if (targetBlock && targetGoal && 
      targetBlock.x === targetGoal.x && 
      targetBlock.y === targetGoal.y) {
    level++;
    
    if (level < levels.length) {
      setMap(levels[level]);
    } else {
      addText("You Win!", { y: 6, color: color`3` });
    }
  }
});